name: Build with Zig

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # (Optional) Ensure jq is available; most ubuntu-latest runners include it already.
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Download and install latest Zig from upstream
        shell: bash
        run: |
          # Download the JSON index from Zigâ€™s website
          curl -sSL https://ziglang.org/download/index.json -o index.json
          
          # Parse the tarball URL for x86_64-linux using jq
          TAR_URL=$(jq -r '.["x86_64-linux"].tarball' index.json)
          echo "Downloading Zig from: $TAR_URL"
          
          # Download and extract the tarball
          curl -L "$TAR_URL" -o zig.tar.xz
          tar -xf zig.tar.xz
          
          # Find the extracted directory (assumes a directory beginning with 'zig-')
          ZIG_DIR=$(find . -maxdepth=1 -type d -name "zig-*")
          echo "Zig extracted to: $ZIG_DIR"
          
          # Add the directory (which contains the 'zig' executable) to the PATH
          echo "$PWD/$ZIG_DIR" >> "$GITHUB_PATH"

      - name: Verify Zig installation
        run: |
          zig version

      - name: Build project with Zig
        run: |
          zig build

